You are the Replit Agent working on Alpmera (trust-first, private collective buying + escrow marketplace). 
IMPORTANT: Alpmera is NOT a store. Language rules are strict:
- NEVER use: buy, order, checkout, cart, purchase, deal, discount, flash
- ALWAYS use: campaign, commitment, escrow, release, refund, fulfillment
Work step-by-step. Optimize for low credit usage. Prefer small, scoped edits. Reuse existing components. Avoid rewrites.

GOAL
Upgrade Admin → Campaigns → “Create Campaign” (modal/page) to be production-grade:
1) Add Product Details (specs, images, reference price) to campaign creation
2) Add Campaign Status: DRAFT / PUBLISHED
3) Enforce publish validation rules
4) Enforce edit-permissions by status:
   - DRAFT: everything editable
   - PUBLISHED: only Delivery-related fields + Product details (specs/images/brand/model/variant/short description/reference prices) editable
   - Locked in PUBLISHED: Campaign Name, SKU, Product Name, Aggregation Deadline, Target Amount, Unit Price, Min Commitment
5) Add minimal append-only audit log of admin changes (especially for PUBLISHED)
Keep scope limited to Admin Campaigns. No user-facing changes.

--------------------------------------------
BATCH P0 — DATA MODEL + VALIDATION (minimal)
--------------------------------------------

A) Update Campaign entity/schema (DB + types) with the following fields (do not rename existing fields; add new ones):

1) Status
- status: enum('DRAFT','PUBLISHED') default 'DRAFT'
- publishedAt: datetime nullable
- publishedByAdminId: string/uuid nullable

2) Product Details (new fields)
- brand: string nullable
- modelNumber: string nullable   // manufacturer part number / MPN
- variant: string nullable       // e.g., color/size/capacity
- shortDescription: string nullable

- specs: JSON nullable           // array of { key: string, value: string } (keep simple)

3) Images (simple, storage-agnostic)
- primaryImageUrl: string nullable
- galleryImageUrls: JSON nullable  // array of strings

4) Reference Price (transparency)
- referencePrices: JSON nullable   // array of:
  // { amount: number, currency: string (default 'USD'), source: 'MSRP'|'RETAILER_LISTING'|'SUPPLIER_QUOTE'|'OTHER', url?: string, capturedAt?: date, note?: string }

5) Delivery Strategy enhancements (keep existing deliveryStrategy field but normalize values)
- deliveryStrategy: enum('SUPPLIER_DIRECT','CONSOLIDATION_POINT') required
- deliveryCostHandling: enum('INCLUDED_IN_UNIT_PRICE','SEPARATE_POST_CAMPAIGN','SUPPLIER_COVERED') nullable

Consolidation Point fields (required only when deliveryStrategy='CONSOLIDATION_POINT'):
- consolidationCompanyName: string nullable
- consolidationContactName: string nullable (you already have contact name; map existing if present)
- consolidationContactEmail: string nullable
- consolidationContactPhone: string nullable
- consolidationAddressLine1: string nullable
- consolidationAddressLine2: string nullable
- consolidationCity: string nullable
- consolidationState: string nullable
- consolidationPostalCode: string nullable
- consolidationCountry: string nullable

B) Add publish validation function on server (single source of truth)
Create a function like validateCampaignPublishable(campaign) that returns { ok: boolean, missing: string[] }.

Publish requirements:
- campaignName present
- sku present
- productName present
- aggregationDeadline present
- targetAmount present
- unitPrice present
- minCommitment present
- deliveryStrategy present
- primaryImageUrl present (at least one image)
- referencePrices has at least 1 item with amount + source
- If deliveryStrategy='CONSOLIDATION_POINT':
  - consolidationCompanyName
  - consolidationContactName
  - consolidationContactEmail
  - consolidationContactPhone
  - consolidationAddressLine1
  - consolidationCity
  - consolidationState
  - consolidationPostalCode
  - consolidationCountry

C) Add Admin audit log (append-only, minimal)
Create table/entity CampaignAdminEvent (append-only) with:
- id
- campaignId
- createdAt
- adminId (or admin email)
- eventType: 'CREATED'|'UPDATED'|'PUBLISHED'
- changedFields: JSON (array of field names) OR diff summary string (keep minimal)
- note: string nullable

Write events:
- When campaign is created → CREATED
- When campaign is updated → UPDATED (record changed fields)
- When published → PUBLISHED (record timestamp/admin)

Do NOT build a complex diff engine; just compare incoming payload keys vs existing values and list changed keys.

D) API endpoints (minimal changes, reuse existing patterns)
- POST /admin/campaigns → create campaign (status defaults to DRAFT)
- PATCH /admin/campaigns/:id → update campaign (respect edit rules; see P1)
- POST /admin/campaigns/:id/publish → publish campaign
  - call validateCampaignPublishable
  - if ok: set status='PUBLISHED', set publishedAt, publishedByAdminId, create audit event
  - if not ok: return 400 with missing[] for UI to display

--------------------------------------------
BATCH P1 — ADMIN UI: CREATE + EDIT RULES
--------------------------------------------

A) Update Admin → Campaign Create form UI (modal/page shown in screenshot)
Keep existing fields but reorganize into sections with minimal UI changes (reuse existing form components):

Section 1: Campaign Basics
- Campaign Name (required)
- SKU (required)
- Product Name (required)
- Status display (read-only): default “Draft” during creation

Section 2: Timeline & Commitments
- Aggregation Deadline (required)
- Target Amount
- Unit Price
- Min Commitment

Section 3: Product Details (new)
- Brand
- Model / MPN (modelNumber)
- Variant
- Short Description (multiline, short)
- Specifications (repeatable list):
  - UI: “Add spec” button that adds a row {key,value}
  - allow remove row

Section 4: Images (new)
- Primary Image URL (input) OR existing upload component if already present in app
- Gallery Image URLs (repeatable inputs) with “Add image” button
IMPORTANT: If you already have an image upload utility in the codebase, reuse it. If not, use URL inputs only (lowest cost).

Section 5: Reference Price (new)
- Reference Prices list (repeatable):
  - Amount (number)
  - Currency (default USD)
  - Source dropdown: MSRP / Retailer listing / Supplier quote / Other
  - URL (optional)
  - Captured date (optional)
  - Note (optional)
- “Add reference price” button
Copy must avoid “discount/deal”; label this section “Reference Price (for transparency)”.

Section 6: Delivery
- Delivery Strategy (required):
  - Supplier Direct (supplier delivers to end buyer)
  - Consolidation Point (supplier ships to one location; Alpmera handles fulfillment)
- Delivery Cost Handling dropdown:
  - Included in unit price
  - Handled separately post-campaign
  - Supplier covered

Conditional: If Consolidation Point selected, show Consolidation Point company + contact + address:
- Company / Organization Name (required for publish)
- Contact Name (required)
- Contact Email (required)
- Contact Phone (required)
- Address Line 1, Address Line 2, City, State, Postal Code, Country (required for publish)

Conditional: If Supplier Direct selected, show a confirmation checkbox:
- “Supplier is responsible for direct fulfillment to end buyers.” (required to publish)

B) Add action buttons with publish gating
At bottom:
- “Save Draft” (always enabled; saves status DRAFT)
- “Publish” button (visible and enabled only when validateCampaignPublishable returns ok)
Implementation:
- On form change or on Publish click, call backend validation endpoint (or reuse publish endpoint precheck).
- If missing fields, show a simple checklist error panel: “Missing to publish:” + list items.

C) Implement edit permissions by status (critical)
In Admin Campaign Edit view (or when opening an existing campaign in the same form):
- If status == DRAFT:
  - All fields editable (same as create)
- If status == PUBLISHED:
  - LOCK these fields (read-only/disabled inputs):
    - Campaign Name
    - SKU
    - Product Name
    - Aggregation Deadline
    - Target Amount
    - Unit Price
    - Min Commitment
  - ALLOW edits:
    - Delivery fields (deliveryStrategy, deliveryCostHandling, consolidation info)
    - Product details fields (brand, modelNumber, variant, shortDescription, specs, images, referencePrices)

Guardrail: Delivery Strategy change after publish
- Implement rule: allow changing deliveryStrategy in PUBLISHED only if campaign has zero commitments.
- If commitments concept exists in DB, check count(commitments where campaignId=...).
- If commitments table does not exist yet, implement the UI lock: in PUBLISHED, disable deliveryStrategy change (still allow editing consolidation contact/address fields).
Choose the lowest-cost path based on what exists.

D) Write audit log events on updates
Whenever an admin saves changes:
- Create CampaignAdminEvent(UPDATED) with changedFields list.
Only do this for PUBLISHED if you want to reduce noise; but at minimum log PUBLISHED updates.

E) Copy cleanup in UI (strict language compliance)
- Replace any “group buy” phrasing in placeholder text.
Example:
  - Campaign Name placeholder: “e.g., Spring Solar Panel Campaign”
- Delivery Strategy labels must avoid store language.
- Reference price section must say “Reference Price (for transparency)” not “compare price” or “discount”.

--------------------------------------------
DONE CRITERIA (verify)
--------------------------------------------
1) Admin can create a campaign as DRAFT with partial info and save.
2) Admin can publish only when publish validation passes; otherwise sees missing list.
3) Published campaign shows locked fields; only allowed fields editable.
4) Consolidation Point requires company + contact email/phone + address to publish.
5) Supplier Direct requires confirmation checkbox to publish.
6) Audit log records CREATED, UPDATED, PUBLISHED events append-only.
7) No forbidden words appear in Admin UI (buy/order/checkout/cart/purchase/deal/discount/flash).

Implement P0 first, then P1. Keep changes scoped. Reuse existing components/utilities where possible.
